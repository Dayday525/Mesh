1 蓝牙低能耗
    蓝牙低功耗（BLE）是一项非常成功的无线技术。很难找到不支持它的智能手机或平板电脑，它是可穿戴技术兴起的关键因素。它适用于医疗设备，智能家居设备，
传感器等。因此，已有数十亿设备正在使用，支持蓝牙低功耗。这些设备可以用作蓝牙网状网络的一部分吗？这是我们将在本文中回答的问题。但对于那些正在你的显示器，
平板电脑或手机上尖叫的人，为了善良，请告诉我！，我会立即塌陷并立即回答这个问题。
    答案是肯定的。大概。
    蓝牙低功耗设备可以参与蓝牙网状网络，只要他们拥有正确的蓝牙低功耗功能和一些额外的软件，在智能手机的情况下，它可以只是一个知道如何与蓝牙网状网络。
换句话说，任何开发人员都可以编写的应用程序。让我们更详细地研究这种激动人心的可能性。

2 Bearers
    要了解标准的非mesh蓝牙低功耗设备如何成为蓝牙mesh网络的一部分，需要我们重新访问蓝牙mesh堆栈，我在本文前面的文章蓝牙mesh简介 - 第2部分中介绍过。
蓝牙mesh网络使用蓝牙低功耗作为其无线电通信栈。究竟如何使用它是蓝牙mesh网络堆栈最底部的承载层的关注点。
    目前，定义了两个承载：广告承载和GATT承载。蓝牙mesh网络设备使用的默认承载是在蓝牙低功耗广告分组内发送和接收蓝牙mesh分组的广告承载。
    具有蓝牙低功耗堆栈的设备允许它们进行广告和扫描，具有支持广告承载所需的基本，先决条件低能量功能，并最终支持完整的蓝牙mesh网络堆栈。
    不支持广告承载且无法升级使用它的设备必须使用GATT承载。使用GATT承载涉及将蓝牙网状协议数据单元（PDU）封装在称为代理协议的协议中，
我们将在本文后面部分了解更多信息。

3 节点和功能
    作为蓝牙网状网络的成员的设备被称为节点。各种产品类型可以是节点：灯，灯开关，恒温器，窗锁，占用传感器等。然而，无论产品类型如何，节点都可以提供
超出其产品特定功能的某些特殊蓝牙网状网络服务。
    蓝牙mesh规范定义了节点可能拥有的特征。具有这些特征中的一个或多个表示该节点可以在网络中扮演相应的特殊角色。定义的功能是：
      中继：中继节点使用广告承载来接收和重传蓝牙网格消息。通过中继功能，蓝牙网状消息可以在设备之间进行多次跳跃，并在网络上直接通过两个设备的直接无线
    电范围。
      朋友：朋友节点可以存储并稍后转发寻址到关联的低功率节点的消息。
      代理：代理节点可以通过一个承载（广告或GATT）接收消息，并通过另一个承载（广告或GATT）重新发送消息。
      低功耗节点（LPN）：LPN是功率受限节点，其可以通过利用朋友节点的支持而有效地在蓝牙网状网络内操作，并且因此使用显着减少的占空比。
4 代理节点 
    代理节点是使非网状蓝牙低功耗设备成为蓝牙网状网络一部分的关键。代理节点的基本目的是执行承载转换。它可以从广告承载转换为GATT承载，反之亦然。
因此，不支持广告承载的设备可以代之以通过GATT连接发送和接收各种类型的蓝牙mesh消息。
    节点通过在features字段中设置代理功能位来指示它可以充当代理节点，这是所有节点拥有的组合数据状态的一部分。

5 蓝牙mesh代理服务
    代理节点实现称为mesh代理服务的GATT服务，在此上下文中，称为代理服务器。mesh代理服务包含两个GATT特征，mesh代理数据输入和网格代理数据输出。
代理客户端使用GATT Write Without Response子过程将代理协议（见下文）PDU写入mesh代理数据特征，并从GATT通知中的mesh代理数据输出特性接收代理协议PDU。
因此，这是连接的GATT设备通过代理节点与蓝牙mesh网络交换数据的机制。

6 发现代理节点
    蓝牙低功耗设备使用GAP广告来促进其他设备的发现。蓝牙网络代理节点使用完全相同的技术，宣传其可用性，作为代理节点的角色，以及它们在GAP可连接广告
数据包中的身份。
    GAP广告包包含各种类型的字段，称为AD类型。这些在核心规范补充中定义。代理节点包括广告包中的以下字段：
      Flags:表示一般可发现模式。
      服务数据:包含与Mesh代理服务相关的数据，该服务标识代理为其提供服务的网络或节点。
      完整的16位服务UUID列表或16位服务UUID的不完整列表:包括Mesh代理服务的UUID。

        识别类型:此字段中的值使我们能够正确解释“标识参数”字段的内容。0x00：网络ID类型 0x01：节点标识类型
        识别参数:网络ID或节点标识，具体取决于标识类型。
    网络ID是从网络密钥（NetKey  - 参见网状网络管理）派生的唯一公共标识符。节点标识源自Proxy Server节点的单播地址和网络标识符的组合，例如其启用的
其中一个子网的网络ID。如果代理服务器是多个子网的成员，它将交错包含每个子网的网络ID的广告包，一次一个广告包。
节点标识广告的主要用途是允许配置器快速直接连接回新配置的节点，以便可以完成新节点的配置。

7 代理协议
    理客户端和代理服务器使用代理协议进行通信，并相互发送代理PDU。这些PDU可以被认为是各种类型的蓝牙mesh的容器。蓝牙mesh访问消息使用核心蓝牙mesh堆栈，
因此消息包含在网络PDU中。meshPDU可以封装在代理PDU中。
    蓝牙mesh配置文件规范中定义了各种信标，包括未设置的设备信标和安全网络信标。代理协议可以容纳蓝牙mesh信标。
    供应过程涉及其自己的协议，并且供应PDU也可以在代理PDU内交换。
    最后，代理客户端和代理服务器可以交换特殊的代理配置消息，我们将在稍后介绍。这些也可以封装在代理PDU中。
    如您所见，大多数类型的mesh数据可以使用代理协议进行交换，因此可以由连接到代理节点的GATT客户端发送和接收。
    代理PDU在不同设备上的大小不同，PDU的大小根据蓝牙低功耗属性协议（ATT）的最大传输单元（MTU）动态设置，这是通过GATT连接传输代理PDU的基础。此外，
代理协议可以通过允许将完整的蓝牙mesh消息封装在代理PDU或多段消息的各个段中来容纳长蓝牙mesh消息。
    需要注意的一点是，任何蓝牙网格节点都可以实现代理协议，因此支持通过GATT连接进行直接交互，而不仅仅是代理节点。这在配置方案中很有用。
    有关代理协议的更多信息，包括代理PDU的格式，可以在蓝牙网状配置文件规范中找到。

8 代理筛选器和代理配置
    代理客户端可以通过配置代理服务器应用的过滤器，精确控制他们收到的网络流量。过滤器采用白名单和黑名单的形式，它们各自指定目标地址列表。列表中的地址
可以是支持的地址类型的任意混合，即单播，组或虚拟地址。目标地址未包含在白名单过滤器中的邮件将被代理服务器的代理过滤器删除。同样，删除包含在黑名单过滤器
中的目的地的消息。代理配置消息在代理客户端和代理服务器之间交换，并允许配置代理过滤器。
9 使用蓝牙低功耗智能手机或平板电脑进行配置
    将新设备添加到蓝牙网状网络的供应过程，通常使用智能手机或平板电脑来执行。大多数此类设备不会实现完整的蓝牙网状网络堆栈，并且很可能他们将使用代理协议
进行与蓝牙网状网络的所有交互，包括配置。如前所述，Provisioning PDU可以封装在Proxy PDU中，因此可以通过代理服务器节点通过GATT连接进行交换。配置协议与
代理协议的使用在蓝牙网状配置文件规范中给出了名称PB-GATT。配置过程在我们关于蓝牙网状网络管理系列的前一篇文章中进行了描述，我们将在本系列后面的相关安全
配置文章中详细介绍。
10 将代理协议与代理节点一起使用需要什么？
    对于诸如智能手机之类的设备，要使用代理协议通过代理节点与蓝牙网状网络通信，设备必须扫描并连接到代理节点。换句话说，它必须支持GAP中心角色。
此外，必须首先配置智能手机。在没有首先配置的情况下，没有设备可以与蓝牙网状网络中的节点交互。
11 摘要
    通过GATT，代理协议和蓝牙网状代理节点支持市场上的蓝牙低功耗设备是一个重大新闻，它为人们已经拥有的大量设备打开了蓝牙网状网络的世界。
我会说这非常令人兴奋。希望你有同样的感受！
